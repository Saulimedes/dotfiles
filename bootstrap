#!/bin/bash
set -eu

confirm() {
  local message="$1"
  shift
  printf "%s [Y/n] " "$message"
  read -r choice
  if echo "$choice" | grep -Eq '^[Yy]?$'; then
    "$@"
  fi
}

shell_base() {
  confirm "Checkout private Fonts?" git submodule update --init --recursive fonts

  if command -v fish &> /dev/null; then
    confirm "Install Fish Plugin Manager?" fish -c "curl -sL https://git.io/fisher | source && fisher install jorgebucaran/fisher"
  fi

  if command -v tmux &> /dev/null; then
    if [ ! -d ~/.tmux/plugins/tpm ]; then
      confirm "Install Tmux Plugin Manager?" git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
    else
      confirm "Update Tmux Plugin Manager?" sh -c "cd ~/.tmux/plugins/tpm && git pull"
    fi
  fi

  confirm "Update Tmux Plugins?" tmux new-session -d "sleep 1" && sleep 0.1 && ~/.tmux/plugins/tpm/bin/update_plugins all
  confirm "Install Dotfiles?" ./install
}

confirm "Install Base Packages?" ./install bootstrap

shell_base
